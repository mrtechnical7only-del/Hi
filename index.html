<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Special Surprise for Benazir</title>
    <!-- Google Font for Romantic Style -->
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">
    <style>
        /* --- CSS STYLES --- */
        body, html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            background: radial-gradient(circle, #1a0012 0%, #000000 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            font-family: 'Dancing Script', cursive;
            touch-action: none;
        }

        #mainCanvas {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 1;
        }

        /* Initial Start Screen */
        #overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            z-index: 100;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            transition: opacity 0.8s;
        }

        .btn {
            padding: 15px 40px;
            font-size: 1.8rem;
            background: #e91e63;
            border: none;
            border-radius: 50px;
            color: white;
            cursor: pointer;
            box-shadow: 0 0 20px #e91e63;
            font-family: 'Dancing Script', cursive;
            margin-top: 20px;
        }

        /* The Animated Heart */
        #heart-ui {
            position: relative;
            z-index: 10;
            cursor: pointer;
            display: none;
            text-align: center;
            transition: opacity 0.5s;
        }

        .heart {
            width: 120px;
            height: 120px;
            background-color: #ff0040;
            position: relative;
            transform: rotate(-45deg);
            animation: pulse 0.6s infinite alternate cubic-bezier(0.215, 0.61, 0.355, 1);
            box-shadow: 0 0 40px #ff0040;
            margin: 0 auto;
        }

        .heart::before, .heart::after {
            content: "";
            width: 120px;
            height: 120px;
            background-color: #ff0040;
            border-radius: 50%;
            position: absolute;
        }

        .heart::before { top: -60px; left: 0; }
        .heart::after { top: 0; left: 60px; }

        @keyframes pulse {
            0% { transform: rotate(-45deg) scale(1); }
            100% { transform: rotate(-45deg) scale(1.3); }
        }

        .msg {
            color: #ffb3c1;
            margin-top: 100px;
            font-size: 1.5rem;
            text-shadow: 0 0 10px rgba(255,179,193,0.5);
        }
    </style>
</head>
<body>

    <!-- Start Overlay for Audio Permission -->
    <div id="overlay">
        <h1 style="font-size: 2.5rem;">For My Love, Benazir</h1>
        <button class="btn" onclick="initExperience()">Click to Start ❤️</button>
    </div>

    <!-- Main Heart to Click -->
    <div id="heart-ui" onclick="explode()">
        <div class="heart"></div>
        <p class="msg">Benazir, touch my heart...</p>
    </div>

    <canvas id="mainCanvas"></canvas>

    <script>
        /* --- JAVASCRIPT LOGIC --- */
        const canvas = document.getElementById('mainCanvas');
        const ctx = canvas.getContext('2d');
        const overlay = document.getElementById('overlay');
        const heartUI = document.getElementById('heart-ui');

        let width, height, particles = [], points = [];
        let animationActive = false;
        let audioCtx;
        const apiKey = ""; // Automatic injection

        // 1. Initialize Audio and Setup
        function initExperience() {
            audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            overlay.style.opacity = '0';
            setTimeout(() => {
                overlay.style.display = 'none';
                heartUI.style.display = 'block';
                startHeartbeat();
            }, 800);
            calculateText();
        }

        // 2. Scan Text for Name Formation
        function calculateText() {
            width = canvas.width = window.innerWidth;
            height = canvas.height = window.innerHeight;

            const tCanvas = document.createElement('canvas');
            const tCtx = tCanvas.getContext('2d');
            tCanvas.width = width;
            tCanvas.height = height;

            let size = width < 600 ? 38 : 75;
            tCtx.fillStyle = 'white';
            tCtx.font = `bold ${size}px 'Dancing Script'`;
            tCtx.textAlign = 'center';
            tCtx.textBaseline = 'middle';
            
            const text = "I LOVE YOU BENAZIR";
            tCtx.fillText(text, width / 2, height / 2);

            const data = tCtx.getImageData(0, 0, width, height).data;
            points = [];
            const gap = width < 600 ? 3 : 5;

            for (let y = 0; y < height; y += gap) {
                for (let x = 0; x < width; x += gap) {
                    const i = (y * width + x) * 4;
                    if (data[i + 3] > 128) {
                        points.push({ x, y });
                    }
                }
            }
        }

        // 3. Particle Class
        class Heart {
            constructor(startX, startY) {
                this.x = startX;
                this.y = startY;
                this.destX = startX;
                this.destY = startY;
                this.size = Math.random() * 2 + 2;
                this.color = `hsl(${Math.random() * 30 + 340}, 100%, 60%)`;
                
                // Blast vector
                const ang = Math.random() * Math.PI * 2;
                const force = Math.random() * 20 + 5;
                this.vx = Math.cos(ang) * force;
                this.vy = Math.sin(ang) * force;
                
                this.friction = 0.95;
                this.mode = 'blast'; // blast -> settle
            }

            update() {
                if (this.mode === 'blast') {
                    this.x += this.vx;
                    this.y += this.vy;
                    this.vx *= this.friction;
                    this.vy *= this.friction;
                    if (Math.abs(this.vx) < 0.1) this.mode = 'settle';
                } else {
                    this.x += (this.destX - this.x) * 0.08;
                    this.y += (this.destY - this.y) * 0.08;
                }
            }

            draw() {
                ctx.fillStyle = this.color;
                const s = this.size;
                ctx.beginPath();
                ctx.moveTo(this.x, this.y);
                ctx.bezierCurveTo(this.x, this.y-s, this.x-s, this.y-s, this.x-s, this.y);
                ctx.bezierCurveTo(this.x-s, this.y+s, this.x, this.y+s, this.x, this.y+s*1.5);
                ctx.bezierCurveTo(this.x, this.y+s, this.x+s, this.y+s, this.x+s, this.y);
                ctx.bezierCurveTo(this.x+s, this.y-s, this.x, this.y-s, this.x, this.y);
                ctx.fill();
            }
        }

        // 4. Interaction Logic
        function explode() {
            if (animationActive) return;
            animationActive = true;
            
            heartUI.style.opacity = '0';
            stopHeartbeat();
            playExplosionSound();
            speak();

            const sx = width / 2;
            const sy = height / 2;

            particles = points.map(p => {
                const h = new Heart(sx, sy);
                h.destX = p.x;
                h.destY = p.y;
                return h;
            });

            loop();
        }

        function loop() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.15)';
            ctx.fillRect(0, 0, width, height);
            particles.forEach(p => { p.update(); p.draw(); });
            requestAnimationFrame(loop);
        }

        // 5. Audio Utilities
        let hInterval;
        function startHeartbeat() {
            const pulse = () => {
                const o = audioCtx.createOscillator();
                const g = audioCtx.createGain();
                o.type = 'sine'; o.frequency.setValueAtTime(55, audioCtx.currentTime);
                g.gain.setValueAtTime(0.4, audioCtx.currentTime);
                g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
                o.connect(g); g.connect(audioCtx.destination);
                o.start(); o.stop(audioCtx.currentTime + 0.1);
            };
            hInterval = setInterval(() => { pulse(); setTimeout(pulse, 200); }, 900);
        }

        function stopHeartbeat() { clearInterval(hInterval); }

        function playExplosionSound() {
            const noise = audioCtx.createBufferSource();
            const buffer = audioCtx.createBuffer(1, audioCtx.sampleRate, audioCtx.sampleRate);
            const data = buffer.getChannelData(0);
            for(let i=0; i<audioCtx.sampleRate; i++) data[i] = Math.random() * 2 - 1;
            noise.buffer = buffer;
            const filt = audioCtx.createBiquadFilter();
            filt.type = 'lowpass'; filt.frequency.setValueAtTime(800, audioCtx.currentTime);
            filt.frequency.exponentialRampToValueAtTime(30, audioCtx.currentTime + 1.2);
            const g = audioCtx.createGain();
            g.gain.setValueAtTime(0.5, audioCtx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 1.2);
            noise.connect(filt); filt.connect(g); g.connect(audioCtx.destination);
            noise.start();
        }

        async function speak() {
            const text = "Say warmly: I love you, Benazir!";
            const payload = {
                contents: [{ parts: [{ text: text }] }],
                generationConfig: { responseModalities: ["AUDIO"], speechConfig: { voiceConfig: { prebuiltVoiceConfig: { voiceName: "Kore" } } } },
                model: "gemini-2.5-flash-preview-tts"
            };
            try {
                const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-tts:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });
                const r = await res.json();
                const b64 = r.candidates[0].content.parts[0].inlineData.data;
                const audio = new Audio(URL.createObjectURL(pcmToWav(b64, 24000)));
                audio.play();
            } catch(e) {}
        }

        function pcmToWav(b64, sr) {
            const pcm = Uint8Array.from(atob(b64), c => c.charCodeAt(0)).buffer;
            const buf = new ArrayBuffer(44 + pcm.byteLength);
            const v = new DataView(buf);
            const s = (o, str) => { for(let i=0; i<str.length; i++) v.setUint8(o+i, str.charCodeAt(i)) };
            s(0, 'RIFF'); v.setUint32(4, 32 + pcm.byteLength, true); s(8, 'WAVE');
            s(12, 'fmt '); v.setUint32(16, 16, true); v.setUint16(20, 1, true);
            v.setUint16(22, 1, true); v.setUint32(24, sr, true);
            v.setUint32(28, sr * 2, true); v.setUint16(32, 2, true);
            v.setUint16(34, 16, true); s(36, 'data'); v.setUint32(40, pcm.byteLength, true);
            new Uint8Array(buf, 44).set(new Uint8Array(pcm));
            return new Blob([buf], { type: 'audio/wav' });
        }

        window.addEventListener('resize', calculateText);

    </script>
</body>
</html>

