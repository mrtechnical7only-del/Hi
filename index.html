<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thermal Receipt Generator</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        canvas { image-rendering: pixelated; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-4 text-slate-800">

    <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8">
        
        <!-- Left Side: Inputs -->
        <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-200">
            <div class="flex items-center gap-3 mb-6">
                <i data-lucide="settings" class="text-indigo-600"></i>
                <h1 class="text-2xl font-black">Receipt Maker</h1>
            </div>

            <div class="space-y-4">
                <div class="space-y-3">
                    <input id="shopName" type="text" value="MINI'S PET STORE" class="w-full p-3 bg-gray-50 border rounded-xl focus:ring-2 ring-indigo-200 outline-none" placeholder="Shop Name">
                    <input id="address" type="text" value="123 Main Street, City" class="w-full p-3 bg-gray-50 border rounded-xl focus:ring-2 ring-indigo-200 outline-none" placeholder="Address">
                    <input id="phone" type="text" value="+91 98765 43210" class="w-full p-3 bg-gray-50 border rounded-xl focus:ring-2 ring-indigo-200 outline-none" placeholder="Phone">
                </div>

                <div class="mt-8">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold uppercase text-xs text-gray-400 tracking-widest">Items</h3>
                        <button onclick="addItem()" class="flex items-center gap-1 text-sm bg-indigo-600 text-white px-4 py-1.5 rounded-full hover:bg-indigo-700 transition">
                            <i data-lucide="plus" size="16"></i> Add Item
                        </button>
                    </div>
                    
                    <div id="itemsContainer" class="space-y-3">
                        <!-- Items will be injected here -->
                    </div>
                </div>

                <div class="mt-6 border-t pt-4">
                    <label class="text-xs font-bold text-gray-400 uppercase">Footer Message</label>
                    <textarea id="footerMsg" class="w-full mt-2 p-3 bg-gray-50 border rounded-xl focus:ring-2 ring-indigo-200 outline-none text-sm h-20">Mini says: Thank you for shopping!</textarea>
                </div>
            </div>
        </div>

        <!-- Right Side: Preview -->
        <div class="flex flex-col items-center">
            <div class="bg-white p-6 rounded-3xl shadow-sm border border-gray-200 w-full max-w-md sticky top-4">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="font-bold flex items-center gap-2"><i data-lucide="receipt-text"></i> Preview</h2>
                    <div class="flex gap-2">
                        <button onclick="openInNewTab()" class="p-2 bg-gray-100 rounded-lg hover:bg-gray-200" title="Open Image">
                            <i data-lucide="external-link"></i>
                        </button>
                        <button onclick="downloadReceipt()" class="p-2 bg-indigo-50 text-indigo-600 rounded-lg hover:bg-indigo-100" title="Download">
                            <i data-lucide="download"></i>
                        </button>
                        <button onclick="shareReceipt()" class="p-2 bg-green-50 text-green-600 rounded-lg hover:bg-green-100" title="Share">
                            <i data-lucide="share-2"></i>
                        </button>
                    </div>
                </div>

                <div class="bg-slate-200 p-6 rounded-2xl flex justify-center overflow-hidden min-h-[400px]">
                    <canvas id="receiptCanvas" class="bg-white shadow-2xl"></canvas>
                </div>

                <div id="statusToast" class="hidden mt-4 p-3 bg-indigo-600 text-white text-center rounded-xl text-sm font-bold animate-pulse"></div>

                <div class="mt-6 space-y-2 text-xs text-gray-500 bg-slate-50 p-3 rounded-lg border">
                    <p>• <b>Thermal Optimized:</b> Design pure black aur white hai.</p>
                    <p>• <b>Share:</b> WhatsApp ya email par bhej sakte hain.</p>
                    <p>• <b>Note:</b> GitHub Pages par "Share" mobile browsers par best chalta hai.</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // State
        let items = [
            { id: 1, name: 'Packet Food (Mini)', price: 150, qty: 2 },
            { id: 2, name: 'Cat Toy', price: 200, qty: 1 }
        ];
        let receiptNo = 'REC-' + Math.floor(1000 + Math.random() * 9000);

        // Elements
        const canvas = document.getElementById('receiptCanvas');
        const itemsContainer = document.getElementById('itemsContainer');
        const shopInput = document.getElementById('shopName');
        const addrInput = document.getElementById('address');
        const phoneInput = document.getElementById('phone');
        const footerInput = document.getElementById('footerMsg');
        const statusToast = document.getElementById('statusToast');

        // Initial Render
        function init() {
            lucide.createIcons();
            renderItems();
            drawReceipt();
            
            // Listeners
            [shopInput, addrInput, phoneInput, footerInput].forEach(el => {
                el.addEventListener('input', drawReceipt);
            });
        }

        function renderItems() {
            itemsContainer.innerHTML = '';
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = "flex gap-2 items-center bg-gray-50 p-2 rounded-xl border border-gray-100";
                div.innerHTML = `
                    <input class="flex-1 bg-transparent p-1 outline-none text-sm" placeholder="Item" value="${item.name}" oninput="updateItem(${item.id}, 'name', this.value)">
                    <input type="number" class="w-12 bg-transparent p-1 outline-none text-sm border-l" value="${item.qty}" oninput="updateItem(${item.id}, 'qty', this.value)">
                    <input type="number" class="w-16 bg-transparent p-1 outline-none text-sm border-l" value="${item.price}" oninput="updateItem(${item.id}, 'price', this.value)">
                    <button onclick="removeItem(${item.id})" class="text-red-400 p-1 hover:text-red-600">
                        <i data-lucide="trash-2" size="16"></i>
                    </button>
                `;
                itemsContainer.appendChild(div);
            });
            lucide.createIcons();
        }

        function addItem() {
            items.push({ id: Date.now(), name: '', price: 0, qty: 1 });
            renderItems();
            drawReceipt();
        }

        function removeItem(id) {
            items = items.filter(i => i.id !== id);
            renderItems();
            drawReceipt();
        }

        function updateItem(id, field, value) {
            const item = items.find(i => i.id === id);
            if (field === 'name') item[field] = value;
            else item[field] = parseFloat(value) || 0;
            drawReceipt();
        }

        function drawReceipt() {
            const ctx = canvas.getContext('2d');
            const width = 384;
            const padding = 20;
            const rowHeight = 25;
            
            const headerHeight = 130;
            const footerHeight = 120;
            const dynamicHeight = headerHeight + (items.length * rowHeight) + 40 + footerHeight;
            
            canvas.width = width;
            canvas.height = dynamicHeight;

            // Background
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, width, dynamicHeight);

            // Text Settings
            ctx.fillStyle = 'black';
            ctx.textAlign = 'center';
            
            // Header
            ctx.font = 'bold 24px "Courier New", Courier, monospace';
            ctx.fillText(shopInput.value.toUpperCase(), width / 2, 40);
            
            ctx.font = '14px Courier New';
            ctx.fillText(addrInput.value, width / 2, 65);
            ctx.fillText(`PH: ${phoneInput.value}`, width / 2, 85);
            ctx.fillText("-".repeat(40), width / 2, 105);

            // Meta
            ctx.textAlign = 'left';
            ctx.fillText(`Date: ${new Date().toLocaleDateString()}`, padding, 125);
            ctx.fillText(`Receipt: ${receiptNo}`, padding, 145);
            ctx.textAlign = 'center';
            ctx.fillText("-".repeat(40), width / 2, 165);

            // Table Header
            ctx.textAlign = 'left';
            ctx.font = 'bold 14px Courier New';
            ctx.fillText("ITEM", padding, 185);
            ctx.textAlign = 'right';
            ctx.fillText("QTY", width - 100, 185);
            ctx.fillText("PRICE", width - padding, 185);

            // Items List
            ctx.font = '14px Courier New';
            let y = 210;
            let total = 0;
            items.forEach(item => {
                ctx.textAlign = 'left';
                ctx.fillText(item.name.substring(0, 18), padding, y);
                ctx.textAlign = 'right';
                ctx.fillText(item.qty.toString(), width - 100, y);
                const subTotal = (item.price * item.qty);
                ctx.fillText(subTotal.toFixed(2), width - padding, y);
                total += subTotal;
                y += rowHeight;
            });

            ctx.textAlign = 'center';
            ctx.fillText("-".repeat(40), width / 2, y + 10);

            // Total
            ctx.textAlign = 'right';
            ctx.font = 'bold 18px Courier New';
            ctx.fillText(`TOTAL: Rs.${total.toFixed(2)}`, width - padding, y + 40);

            // Footer
            ctx.textAlign = 'center';
            ctx.font = 'italic 14px Courier New';
            ctx.fillText(footerInput.value, width / 2, y + 75);
            ctx.font = '10px Courier New';
            ctx.fillText("*** Design for Thermal Printers ***", width / 2, y + 100);
        }

        function showStatus(msg) {
            statusToast.innerText = msg;
            statusToast.classList.remove('hidden');
            setTimeout(() => statusToast.classList.add('hidden'), 3000);
        }

        function downloadReceipt() {
            const link = document.createElement('a');
            link.download = `receipt-${receiptNo}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
            showStatus("Image Downloaded!");
        }

        function openInNewTab() {
            const dataUrl = canvas.toDataURL('image/png');
            const w = window.open('about:blank');
            setTimeout(() => {
                w.document.write(`<title>Receipt Preview</title><body style="margin:0; background:#f0f0f0; display:flex; justify-content:center; align-items:center; height:100vh;"><img src="${dataUrl}" style="box-shadow:0 10px 30px rgba(0,0,0,0.2); background:white;"></body>`);
            }, 0);
        }

        async function shareReceipt() {
            canvas.toBlob(async (blob) => {
                const file = new File([blob], 'receipt.png', { type: 'image/png' });
                if (navigator.canShare && navigator.canShare({ files: [file] })) {
                    try {
                        await navigator.share({
                            files: [file],
                            title: 'Thermal Receipt',
                            text: 'Purchase details from ' + shopInput.value
                        });
                    } catch (e) {
                        showStatus("Share cancelled.");
                    }
                } else {
                    showStatus("Browser share block kar raha hai. Download use karein.");
                }
            });
        }

        // Boot
        window.onload = init;
    </script>
</body>
</html>

