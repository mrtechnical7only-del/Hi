<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>High-Res Thermal Receipt Generator</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body { font-family: 'Inter', sans-serif; }
        /* Smooth display on screen */
        #receiptCanvas { 
            image-rendering: auto; 
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body class="bg-slate-100 min-h-screen p-4 text-slate-800">

    <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8">
        
        <!-- Left Side: Inputs -->
        <div class="bg-white p-6 rounded-3xl shadow-xl border border-slate-200">
            <div class="flex items-center gap-3 mb-6">
                <i data-lucide="settings" class="text-indigo-600"></i>
                <h1 class="text-2xl font-black">Receipt Maker (High Res)</h1>
            </div>

            <div class="space-y-4">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="col-span-2">
                        <label class="text-[10px] font-bold text-slate-400 uppercase ml-1">Shop Name</label>
                        <input id="shopName" type="text" value="MINI'S PET STORE" class="w-full p-3 bg-slate-50 border rounded-xl focus:ring-2 ring-indigo-200 outline-none">
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase ml-1">Address</label>
                        <input id="address" type="text" value="123 Main Street, City" class="w-full p-3 bg-slate-50 border rounded-xl focus:ring-2 ring-indigo-200 outline-none">
                    </div>
                    <div>
                        <label class="text-[10px] font-bold text-slate-400 uppercase ml-1">Phone</label>
                        <input id="phone" type="text" value="+91 98765 43210" class="w-full p-3 bg-slate-50 border rounded-xl focus:ring-2 ring-indigo-200 outline-none">
                    </div>
                </div>

                <div class="mt-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="font-bold uppercase text-xs text-slate-400 tracking-widest">Items List</h3>
                        <button onclick="addItem()" class="flex items-center gap-1 text-sm bg-indigo-600 text-white px-4 py-2 rounded-xl hover:bg-indigo-700 shadow-md transition">
                            <i data-lucide="plus" size="16"></i> Add Item
                        </button>
                    </div>
                    
                    <div id="itemsContainer" class="space-y-3 max-h-[300px] overflow-y-auto pr-2">
                        <!-- Items injected here -->
                    </div>
                </div>

                <div class="mt-6 border-t pt-4">
                    <label class="text-[10px] font-bold text-slate-400 uppercase ml-1">Footer Message</label>
                    <textarea id="footerMsg" class="w-full mt-2 p-3 bg-slate-50 border rounded-xl focus:ring-2 ring-indigo-200 outline-none text-sm h-20">Mini says: Thank you for shopping!</textarea>
                </div>
            </div>
        </div>

        <!-- Right Side: Preview -->
        <div class="flex flex-col items-center">
            <div class="bg-white p-6 rounded-3xl shadow-xl border border-slate-200 w-full max-w-md sticky top-4">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="font-bold flex items-center gap-2"><i data-lucide="receipt-text"></i> Live Preview</h2>
                    <div class="flex gap-2">
                        <button onclick="openInNewTab()" class="p-2 bg-slate-100 rounded-xl hover:bg-slate-200 transition" title="View Full Image">
                            <i data-lucide="maximize-2"></i>
                        </button>
                        <button onclick="downloadReceipt()" class="p-2 bg-indigo-50 text-indigo-600 rounded-xl hover:bg-indigo-100 transition" title="Download High-Res">
                            <i data-lucide="download"></i>
                        </button>
                        <button onclick="shareReceipt()" class="p-2 bg-green-50 text-green-600 rounded-xl hover:bg-green-100 transition" title="Share">
                            <i data-lucide="share-2"></i>
                        </button>
                    </div>
                </div>

                <div class="bg-slate-200 p-4 rounded-2xl flex justify-center overflow-hidden min-h-[450px]">
                    <div class="w-full flex justify-center overflow-y-auto max-h-[600px] bg-white rounded-lg shadow-inner">
                        <canvas id="receiptCanvas"></canvas>
                    </div>
                </div>

                <div id="statusToast" class="hidden mt-4 p-3 bg-indigo-600 text-white text-center rounded-xl text-sm font-bold animate-pulse"></div>

                <div class="mt-6 grid grid-cols-2 gap-2">
                    <div class="p-3 bg-blue-50 rounded-xl text-[10px] text-blue-700">
                        <b>High Definition:</b> 2x pixel density for clear text on WhatsApp.
                    </div>
                    <div class="p-3 bg-green-50 rounded-xl text-[10px] text-green-700">
                        <b>Eco Print:</b> optimized for 58mm thermal printers.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Settings
        const SCALE = 2; // Increase resolution (2 means 2x pixels)
        const BASE_WIDTH = 384; 
        
        let items = [
            { id: 1, name: 'Packet Food (Mini)', price: 150, qty: 2 },
            { id: 2, name: 'Cat Toy (Pink)', price: 200, qty: 1 }
        ];
        let receiptNo = 'REC-' + Math.floor(1000 + Math.random() * 9000);

        const canvas = document.getElementById('receiptCanvas');
        const itemsContainer = document.getElementById('itemsContainer');
        const shopInput = document.getElementById('shopName');
        const addrInput = document.getElementById('address');
        const phoneInput = document.getElementById('phone');
        const footerInput = document.getElementById('footerMsg');
        const statusToast = document.getElementById('statusToast');

        function init() {
            lucide.createIcons();
            renderItems();
            drawReceipt();
            
            [shopInput, addrInput, phoneInput, footerInput].forEach(el => {
                el.addEventListener('input', drawReceipt);
            });
        }

        function renderItems() {
            itemsContainer.innerHTML = '';
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = "flex gap-2 items-center bg-slate-50 p-2 rounded-xl border border-slate-100 shadow-sm";
                div.innerHTML = `
                    <input class="flex-1 bg-transparent p-1 outline-none text-sm font-semibold" placeholder="Item" value="${item.name}" oninput="updateItem(${item.id}, 'name', this.value)">
                    <div class="flex items-center bg-white rounded-lg border px-2">
                        <span class="text-[10px] text-slate-400 mr-1">Q</span>
                        <input type="number" class="w-10 bg-transparent p-1 outline-none text-sm" value="${item.qty}" oninput="updateItem(${item.id}, 'qty', this.value)">
                    </div>
                    <div class="flex items-center bg-white rounded-lg border px-2">
                        <span class="text-[10px] text-slate-400 mr-1">₹</span>
                        <input type="number" class="w-16 bg-transparent p-1 outline-none text-sm" value="${item.price}" oninput="updateItem(${item.id}, 'price', this.value)">
                    </div>
                    <button onclick="removeItem(${item.id})" class="text-red-400 p-2 hover:bg-red-50 rounded-lg transition">
                        <i data-lucide="trash-2" size="16"></i>
                    </button>
                `;
                itemsContainer.appendChild(div);
            });
            lucide.createIcons();
        }

        function addItem() {
            items.push({ id: Date.now(), name: '', price: 0, qty: 1 });
            renderItems();
            drawReceipt();
        }

        function removeItem(id) {
            items = items.filter(i => i.id !== id);
            renderItems();
            drawReceipt();
        }

        function updateItem(id, field, value) {
            const item = items.find(i => i.id === id);
            if (field === 'name') item[field] = value;
            else item[field] = parseFloat(value) || 0;
            drawReceipt();
        }

        function drawReceipt() {
            const ctx = canvas.getContext('2d');
            const padding = 20;
            const rowHeight = 25;
            
            const headerHeight = 140;
            const footerHeight = 130;
            const baseDynamicHeight = headerHeight + (items.length * rowHeight) + 40 + footerHeight;
            
            // Apply Resolution Scaling
            canvas.width = BASE_WIDTH * SCALE;
            canvas.height = baseDynamicHeight * SCALE;
            
            // Set scale for drawing context
            ctx.scale(SCALE, SCALE);

            // Background
            ctx.fillStyle = 'white';
            ctx.fillRect(0, 0, BASE_WIDTH, baseDynamicHeight);

            ctx.fillStyle = 'black';
            ctx.textAlign = 'center';
            
            // Header
            ctx.font = 'bold 24px "Courier New", Courier, monospace';
            ctx.fillText(shopInput.value.toUpperCase(), BASE_WIDTH / 2, 45);
            
            ctx.font = '14px "Courier New"';
            ctx.fillText(addrInput.value, BASE_WIDTH / 2, 70);
            ctx.fillText(`PH: ${phoneInput.value}`, BASE_WIDTH / 2, 90);
            ctx.fillText("-".repeat(42), BASE_WIDTH / 2, 110);

            // Meta Info
            ctx.textAlign = 'left';
            ctx.font = '13px "Courier New"';
            ctx.fillText(`Date: ${new Date().toLocaleDateString()} ${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}`, padding, 130);
            ctx.fillText(`Receipt: ${receiptNo}`, padding, 150);
            
            ctx.textAlign = 'center';
            ctx.fillText("-".repeat(42), BASE_WIDTH / 2, 170);

            // Table Header
            ctx.textAlign = 'left';
            ctx.font = 'bold 14px "Courier New"';
            ctx.fillText("ITEM", padding, 190);
            ctx.textAlign = 'right';
            ctx.fillText("QTY", BASE_WIDTH - 100, 190);
            ctx.fillText("PRICE", BASE_WIDTH - padding, 190);

            // Items List
            ctx.font = '14px "Courier New"';
            let y = 215;
            let total = 0;
            items.forEach(item => {
                ctx.textAlign = 'left';
                // Trim long names
                const displayName = item.name.length > 18 ? item.name.substring(0,16) + '..' : item.name;
                ctx.fillText(displayName || 'Item', padding, y);
                
                ctx.textAlign = 'right';
                ctx.fillText(item.qty.toString(), BASE_WIDTH - 100, y);
                const subTotal = (item.price * item.qty);
                ctx.fillText(subTotal.toFixed(2), BASE_WIDTH - padding, y);
                total += subTotal;
                y += rowHeight;
            });

            ctx.textAlign = 'center';
            ctx.fillText("-".repeat(42), BASE_WIDTH / 2, y + 10);

            // Total
            ctx.textAlign = 'right';
            ctx.font = 'bold 18px "Courier New"';
            ctx.fillText(`TOTAL: ₹${total.toFixed(2)}`, BASE_WIDTH - padding, y + 45);

            // Footer
            ctx.textAlign = 'center';
            ctx.font = 'italic 14px "Courier New"';
            ctx.fillText(footerInput.value, BASE_WIDTH / 2, y + 85);
            
            ctx.font = '10px "Courier New"';
            ctx.fillText("********************************", BASE_WIDTH / 2, y + 110);
            ctx.fillText("THANK YOU - VISIT AGAIN", BASE_WIDTH / 2, y + 125);
        }

        function showStatus(msg) {
            statusToast.innerText = msg;
            statusToast.classList.remove('hidden');
            setTimeout(() => statusToast.classList.add('hidden'), 3000);
        }

        function downloadReceipt() {
            const link = document.createElement('a');
            link.download = `receipt-${receiptNo}.png`;
            link.href = canvas.toDataURL('image/png', 1.0); // Full quality
            link.click();
            showStatus("HD Image Downloaded!");
        }

        function openInNewTab() {
            const dataUrl = canvas.toDataURL('image/png');
            const w = window.open('about:blank');
            w.document.write(`<title>HD Receipt</title><body style="margin:0; background:#1e293b; display:flex; justify-content:center; align-items:center; min-height:100vh;"><img src="${dataUrl}" style="box-shadow:0 25px 50px -12px rgba(0,0,0,0.5); background:white; max-width:90%;"></body>`);
        }

        async function shareReceipt() {
            canvas.toBlob(async (blob) => {
                const file = new File([blob], 'receipt.png', { type: 'image/png' });
                if (navigator.canShare && navigator.canShare({ files: [file] })) {
                    try {
                        await navigator.share({
                            files: [file],
                            title: 'Thermal Receipt',
                            text: 'Purchase details from ' + shopInput.value
                        });
                    } catch (e) {
                        showStatus("Share cancelled.");
                    }
                } else {
                    showStatus("Mobile browser use karein share ke liye.");
                }
            }, 'image/png', 1.0);
        }

        window.onload = init;
    </script>
</body>
</html>

